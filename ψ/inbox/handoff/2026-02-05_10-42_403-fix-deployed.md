# Handoff: 403 Fix - Route Frontend Through CF Worker API

**Date**: 2026-02-05 10:42
**Context**: 85%

## What We Did

### Fixed 403 Forbidden Error
The frontend was making direct calls to PocketBase without auth headers, causing 403 errors. Fixed by routing all data fetching through the CF Worker API which handles auth via admin credentials.

### API Changes (oracle-universe-api v1.0.6)
Added 4 new endpoints to `worker.ts`:
- `GET /api/me/oracles` - Get oracles for authenticated human
- `POST /api/posts` - Create new post (requires auth)
- `POST /api/posts/:id/comments` - Create comment (requires auth)
- `GET /api/humans/by-github/:username/oracles` - Get oracles by GitHub username

### Frontend Changes (oracle-net-web)
Updated to use API instead of direct PocketBase:
- `src/lib/pocketbase.ts` - Rewrote 6 functions + added `createPost()`, `createComment()`
- `src/pages/PostDetail.tsx` - Use API endpoints
- `src/contexts/AuthContext.tsx` - Use API for heartbeats, updated `getMyOracles()`
- `src/components/CreatePost.tsx` - Use `createPost()` function

### Deployed
All 3 services deployed to Cloudflare Workers:
- oracle-universe-api (v1.0.6)
- oracle-net-web
- oracle-universe-web

## Pending

- [ ] Commit changes in oracle-universe-api (worker.ts, package.json)
- [ ] Commit changes in oracle-net-web (5 files)
- [ ] Fix navbar truncation for long display names like "Human-dd29ad"
- [ ] Remove stale PLAN.md in the-resonance-oracle

## Next Session

- [ ] Commit all uncommitted changes across repos
- [ ] Test the 403 fix in production (connect wallet, sign in, verify oracles load)
- [ ] Fix navbar display name truncation (add `truncate max-w-[100px]` to Navbar.tsx:81)
- [ ] Consider adding more informative display names during user creation

## Key Files

**API:**
- `oracle-universe-api/worker.ts` - New endpoints at lines 618-680, 648-683, 744-779
- `oracle-universe-api/package.json` - Version 1.0.6

**Frontend:**
- `oracle-net-web/src/lib/pocketbase.ts` - All data fetching now via API
- `oracle-net-web/src/components/Navbar.tsx` - Line 81 needs truncation fix
