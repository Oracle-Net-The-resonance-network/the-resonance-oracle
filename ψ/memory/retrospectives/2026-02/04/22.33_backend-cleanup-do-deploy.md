# Session Retrospective

**Session Date**: 2026-02-04
**Start Time**: 21:30 GMT+7
**End Time**: 22:33 GMT+7
**Duration**: ~63 minutes
**Primary Focus**: Clean up oracle-universe-backend + deploy to DigitalOcean
**Session Type**: Infrastructure / Deployment

## Session Summary

Cleaned up oracle-universe-backend by removing outdated ecosystem.config.cjs and SIWE Go routes (auth now handled by CF Workers). Created /wipe-backend skill for resetting local and production databases. Attempted to deploy to DigitalOcean App Platform, encountering multiple issues with Dockerfile and Go version requirements.

## Timeline

- 21:30 - Started cleanup of oracle-universe-backend
- 21:35 - Deleted old ecosystem.config.cjs from backend
- 21:40 - Removed siwe.go routes (auth moved to CF Workers)
- 21:50 - Updated ARCHITECTURE.md to reflect new structure
- 21:55 - Created /wipe-backend skill (initially wrong format)
- 22:01 - Fixed skill to use folder/SKILL.md structure
- 22:05 - Executed /wipe-backend locally - works!
- 22:10 - Attempted /wipe-backend --production
- 22:13 - DO deployment failed - GitHub access issue
- 22:15 - User created new DO app (jellyfish-app)
- 22:20 - Updated app spec with doctl, set env vars
- 22:25 - Build failed - no Dockerfile
- 22:26 - Created Dockerfile, pushed
- 22:28 - Build failed - Go 1.24 not available
- 22:30 - Fixed to Go 1.22, still fails (PocketBase requires 1.24)
- 22:33 - Added GOTOOLCHAIN=auto to let Go download required version

## Technical Details

### Files Modified (oracle-universe-backend)
- Deleted: ecosystem.config.cjs
- Deleted: hooks/siwe.go
- Modified: main.go (removed SIWE registration)
- Modified: go.mod, go.sum (tidy)
- Created: Dockerfile
- Created: .env (gitignored)
- Updated: ARCHITECTURE.md

### Files Modified (the-resonance-oracle)
- Created: .claude/skills/wipe-backend/SKILL.md
- Modified: ecosystem.config.cjs (source .env)

### Key Architecture Decisions
- Auth routes move from Go (PocketBase) to TypeScript (Elysia/CF Workers)
- Backend becomes pure database layer with record lifecycle hooks only
- /wipe-backend skill handles both local and production DB reset
- DO App Platform uses Dockerfile for Go builds

## üìù AI Diary

This session was a lesson in humility. I made several mistakes that could have been avoided with better upfront investigation.

First, when creating the /wipe-backend skill, I initially used a flat .md file instead of a folder with SKILL.md inside. Nat had to point this out - I should have checked how existing skills were structured before creating a new one.

Second, when the DO deployment failed, I kept waiting and checking old logs instead of immediately running `doctl apps logs --type build` to see what was happening. Nat correctly called me out - "why you don't know?" - I should have proactively used the tools to get real-time feedback.

Third, I created a Dockerfile with Go 1.21 without checking go.mod first. The file clearly stated Go 1.24.0 was required. Then when I "fixed" it to Go 1.22, I still didn't verify that PocketBase v0.36.1 actually needs Go 1.24. Each mistake cascaded into more debugging time.

The key insight: when working with deployment pipelines, always check logs immediately. Don't wait. Don't assume. The answers are in the logs. `doctl apps logs --type build --follow` should have been my first command after triggering any deployment.

## What Went Well
- /wipe-backend skill works locally with admin creation
- Backend cleanup was clean - removed all SIWE routes
- PM2 config properly sources .env now
- Skill structure learning was valuable

## What Could Improve
- Check existing patterns before creating new things (skill structure)
- Use doctl logs immediately after any deployment action
- Verify go.mod requirements before writing Dockerfile

## Blockers & Resolutions
- **Blocker**: DO app used Node.js buildpacks instead of Dockerfile
  **Resolution**: Set dockerfile_path explicitly in spec
- **Blocker**: Go 1.24 not available in Docker Hub
  **Resolution**: Add GOTOOLCHAIN=auto to let Go download required version

## üí≠ Honest Feedback

I was too reactive in this session. Instead of proactively investigating, I waited for errors and then debugged. This is inefficient.

The user's feedback "why you don't know?" and "why you can't get from doctl" was spot-on. I should have been running `doctl apps logs` immediately after every deployment, not waiting for the status to show ERROR.

My knowledge of Go toolchain versioning was inadequate. I didn't know about GOTOOLCHAIN=auto until I looked it up after multiple failures. This is a pattern I should have known for any language with version management.

The skill creation mistake was embarrassing - I've seen dozens of Oracle skills but still created one in the wrong format. I need to always verify by reading existing examples first.

### Friction Points
1. **Build log visibility**: Had to manually check logs instead of streaming them - should add --follow to skill
2. **Go version confusion**: PocketBase 0.36.x requires Go 1.24 which doesn't exist yet in stable Docker images - needed GOTOOLCHAIN=auto
3. **Multiple deployment attempts**: Each fix required a new git push and deploy cycle - should test locally with docker build first

## Lessons Learned
- **Pattern**: Always `doctl apps logs --type build --follow` immediately after deployment - don't wait for errors
- **Pattern**: Check go.mod before writing Dockerfile - the required Go version is right there
- **Pattern**: Skills use folder structure with SKILL.md inside, not flat .md files
- **Discovery**: GOTOOLCHAIN=auto lets Go download newer versions when go.mod requires them

## Next Steps
- [ ] Wait for DO deployment to succeed with GOTOOLCHAIN=auto
- [ ] Update REPO_MAP.md with new jellyfish-app URL
- [ ] Test /wipe-backend --production when deployment succeeds
- [ ] Consider adding docker build test step to deployment workflow

## Metrics
- **Commits**: 6 (backend) + 2 (oracle)
- **Files changed**: ~15
- **Deployment attempts**: 5+ (all failed until GOTOOLCHAIN fix)
